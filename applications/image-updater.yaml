apiVersion: argoproj.io/v1alpha1
kind: ImageUpdater
metadata:
  name: apps-image-updater
  namespace: argocd
spec:
  namespace: argocd

  applicationRefs:
    - namePattern: "myapp1-helm"
      images:
        - alias: java-app
          imageName: narland/java
          commonUpdateSettings:
            updateStrategy: newest-build
          manifestTargets:
            helm:
              name: image.repository
              tag: image.tag
          # вот тут можно указать секрет для DockerHub
          registry:
            credentialsSecret: regcred

    - namePattern: "myapp2-helm"
      images:
        - alias: java-app
          imageName: narland/java
          commonUpdateSettings:
            updateStrategy: newest-build
          manifestTargets:
            helm:
              name: image.repository
              tag: image.tag
          registry:
            credentialsSecret: regcred

  writeBackConfig:
    method: git
    gitConfig:
      repository: git@github.com:Egor-Dragun/argocd.git
      branch: HEAD
      writeBackTarget: helmvalues:newchart/values-{{ .Application.Name }}.yaml
